@using MetalTrade.Domain.Enums
@using MetalTrade.Web.ViewModels.Advertisement
@model AdvertisementViewModel

@{
    var firstImage = Model.Photoes?.FirstOrDefault()?.PhotoLink ?? "";
}

<div class="card h-100 shadow-sm position-relative">

    <img src="@(string.IsNullOrEmpty(firstImage) ? "/images/default/advertisement.jpg" : firstImage)"
         class="card-img-top"
         style="height:160px; object-fit:cover;" alt="Фото" />

    @if (ViewBag.IsOwner)
    {
        @switch (Model.Status)
        {
            case (int)AdvertisementStatus.Draft:
                <div class="position-absolute small bg-warning-subtle top-0 m-1 p-1 opacity-75">На рассмотрении</div>
                break;
            case (int)AdvertisementStatus.Active:
                <div class="position-absolute small bg-success-subtle top-0 m-1 p-1 opacity-75">Активно</div>
                break;
            case (int)AdvertisementStatus.Archived:
                <div class="position-absolute small bg-secondary-subtle top-0 m-1 p-1 opacity-75">Деактивированные</div>
                break;
            case (int)AdvertisementStatus.Rejected:
                <div class="position-absolute small bg-danger-subtle top-0 m-1 p-1 opacity-75">Отклонено</div>
                break;
        }
    }
        
    <div class="card-body">
        <h6 class="card-title text-truncate">@Model.Title</h6>
        <p class="card-text small text-muted">
            @(string.IsNullOrEmpty(Model.Body)
                ? ""
                : (Model.Body.Length > 80 ? Model.Body.Substring(0, 80) + "..." : Model.Body))
        </p>

        <div class="d-flex gap-2">
            <a asp-controller="Advertisement"
               asp-action="Details"
               asp-route-id="@Model.Id"
               class="btn btn-outline-primary btn-sm">Просмотр</a>
            
            @if (User.IsInRole("Supplier"))
            {
                <a asp-controller="Advertisement"
                   asp-action="Edit"
                   asp-route-id="@Model.Id"
                   class="btn btn-outline-warning btn-sm">Редактировать</a>
            }            
        </div>
    </div>
</div>