@using MetalTrade.Domain.Enums
@model List<MetalTrade.Web.ViewModels.Advertisement.AdvertisementViewModel>

@{
	var isAdmin = ViewData["IsAdmin"] as bool? ?? false;
	var isAuthenticated = User.Identity != null && User.Identity.IsAuthenticated;
}


@if (!Model.Any() && isAuthenticated)
{
	<h4 class="">Ничего не найдено! </h4>
}
else
{
	<div class="container mt-4">
		<div class="row">
			@foreach (var ads in Model)
			{
				<div class="col-md-4 mb-4">
					<div class="card shadow-sm position-relative">

						@if (ads.Photoes != null && ads.Photoes.Count > 0)
						{
							string carouselId = $"carousel-{ads.Id}";
							<div id="@carouselId" class="carousel slide" data-bs-ride="carousel">
								<div class="carousel-inner">
									@for (int i = 0; i < ads.Photoes.Count; i++)
									{
										var photo = ads.Photoes[i];
										<div class="carousel-item @(i == 0 ? "active" : "")">
											<img src="@photo.PhotoLink" class="d-block w-100" alt="Фото объявления"
											     style="height: 200px; object-fit: cover;" />
										</div>
									}
								</div>
								<button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
									<span class="carousel-control-prev-icon"></span>
								</button>
								<button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
									<span class="carousel-control-next-icon"></span>
								</button>
							</div>
						}
						else
						{
							<div id="default-image" class="carousel slide" data-bs-ride="carousel">
								<div class="carousel-inner">
									<div class="carousel-item active">
										<img src="/images/default/advertisement.jpg" class="d-block w-100" alt="Фото объявления"
											 style="height: 200px; object-fit: cover;" />
									</div>
								</div>
								<button class="carousel-control-prev" type="button" data-bs-target="#default-image" data-bs-slide="prev">
									<span class="carousel-control-prev-icon"></span>
								</button>
								<button class="carousel-control-next" type="button" data-bs-target="#default-image" data-bs-slide="next">
									<span class="carousel-control-next-icon"></span>
								</button>
							</div>
						}
						<div class="position-absolute top-0 end-0 m-1 text-end">
							@if(ads.IsAd)
							{
								<div class="p-1 small bg-primary opacity-75 text-light mb-1">
									Реклама
								</div>
							}
							@if (ads.IsTop)
							{
								<div class="p-1 small bg-info opacity-75 text-light d-inline-block">
									Топ
								</div>
							}
						</div>
						@if (isAdmin)
						{
							<div class="position-absolute small top-0 m-1 p-1 opacity-75 
	                            @(ads.Status == (int)AdvertisementStatus.Draft ? "bg-warning-subtle" :
							                                        ads.Status == (int)AdvertisementStatus.Active ? "bg-success-subtle" :
							                                        ads.Status == (int)AdvertisementStatus.Rejected ? "bg-danger-subtle" :
							                                        "bg-info-subtle")">
								@(ads.Status switch
								{
									(int)AdvertisementStatus.Draft => "На рассмотрении",
									(int)AdvertisementStatus.Active => "Активно",
									(int)AdvertisementStatus.Rejected => "Отклонено",
									_ => "Деактивировано"
								})
							</div>
						}

						<div class="card-body">
							<h5 class="card-title">@ads.Title</h5>							
							<p class="card-text fs-6 text-muted d-inline">Цена: </p>
							<p class="card-text fw-bold fs-5 d-inline">@ads.Price.ToString("N0")</p>

							<div>
								Автор: 
								<a 
									asp-action="User" 
									asp-controller="Profile" 
									asp-route-id="@ads.User.Id" 
									class="fw-bold link-primary link-underline-opacity-0">
										@ads.User.UserName
								</a>
								@if(ads.User.IsTop)
								{
									<strong>(ТОП)</strong>
								}
							</div>
							@if (isAuthenticated)
							{
								<div class="card-text">Номер: <b>(+996)@ads.PhoneNumber</b></div>
							}

							<a asp-action="Details" asp-route-id="@ads.Id" class="btn btn-primary mt-2 w-100">Подробнее</a>
						</div>

					</div>
				</div>
			}
		</div>
	</div>
}

